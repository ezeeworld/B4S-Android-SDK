<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Using the SDK - Neerby SDK Android</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Using the SDK";
    var mkdocs_page_input_path = "using_the_sdk.md";
    var mkdocs_page_url = "/using_the_sdk/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Neerby SDK Android</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../include_in_project/">Include the SDK in your project</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Using the SDK</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#base-integration">Base integration</a></li>
    

    <li class="toctree-l2"><a href="#prevent-your-application-to-trigger-notifications-resulting-of-mock-locations">Prevent your application to trigger notifications resulting of mock locations</a></li>
    

    <li class="toctree-l2"><a href="#recording-user-data">Recording user data</a></li>
    

    <li class="toctree-l2"><a href="#application-tagging">Application tagging</a></li>
    

    <li class="toctree-l2"><a href="#custom-notifications">Custom notifications</a></li>
    

    <li class="toctree-l2"><a href="#push-notifications">Push notifications</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#deep-linking">Deep linking</a></li>
        
            <li><a class="toctree-l3" href="#dynamic-notifications-customisation">Dynamic notifications customisation</a></li>
        
            <li><a class="toctree-l3" href="#android-6">Android 6</a></li>
        
        </ul>
    

    <li class="toctree-l2"><a href="#using-a-transient-device-uuid">Using a transient device UUID</a></li>
    

    <li class="toctree-l2"><a href="#getting-the-users-worlplace-and-home-coordinates">Getting the user's worlplace and home coordinates</a></li>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../migration_guide/">Migration guide</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Neerby SDK Android</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Using the SDK</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Depending on how you use the Neerby SDK, some steps are mandatory, some are optional.</p>
<ul>
<li>Base integration for counting visits</li>
<li>Recording user data</li>
<li>Beacon-based notifications</li>
<li>Application tagging</li>
<li>Push notifications</li>
</ul>
<h1 id="base-integration">Base integration</h1>
<ul>
<li>Add the <code>Application ID</code> provided by Ezeeworld to the <code>Application</code> object in you <code>AndroidManifest.xml</code>. Depending on your project configuration you might have to create this object</li>
</ul>
<pre><code class="xml">&lt;application
   android:name=&quot;com.ezeeworld.b4s.android.sdk.sample.SampleApp&quot;
   android:label=&quot;@string/app_name&quot; &gt;
   ...
   &lt;meta-data android:name=&quot;by.neer.sdk.APP_ID&quot; android:value=&quot;MY-APP-ID&quot; /&gt;
   ...
&lt;/application&gt;
</code></pre>

<p>And replace <code>MY-APP-ID</code> with your unique application ID.</p>
<p><strong>Warning</strong>: if this key is present with a valid application identifier, the SDK will init automatically upon app launch. It will register the device with the Neer.by server (but won't search for beacons, or display notifications, or send geolocalized information to our server). If you want to fully control when the device will be registered to our back-end, add a <code>by.neer.sdk.DISABLE_AUTOMATIC_INIT</code> key to your Manifest, with a <code>true</code> value.</p>
<p><code>xml
 &lt;meta-data android:name="by.neer.sdk.DISABLE_AUTOMATIC_INIT" android:value="true" /&gt;</code></p>
<ul>
<li>Import the SDK in your Application subclass:</li>
</ul>
<pre><code class="java">import com.ezeeworld.b4s.android.sdk.B4SSettings;
import com.ezeeworld.b4s.android.sdk.monitor.MonitoringManager;
</code></pre>

<ul>
<li>Start the SDK in the <code>onCreate</code> method:</li>
</ul>
<pre><code class="java">B4SSettings settings = B4SSettings.init(this);
MonitoringManager.ensureMonitoringService(this);
</code></pre>

<h1 id="prevent-your-application-to-trigger-notifications-resulting-of-mock-locations">Prevent your application to trigger notifications resulting of mock locations</h1>
<p>On Android, some applications (like Lockito) can generate mock locations (typically for debuging purpose). By default, mock locations are authorised by the Neer.by SDK. You can disable them with the following code :</p>
<pre><code class="java">B4SSettings.get().setDiscardMockLocations(true);
</code></pre>

<h1 id="recording-user-data">Recording user data</h1>
<p>Neerby can relate events to individual customers. Supplying the customer details is typically done on startup and/or after a user signed in to his/her account. In these cases you can update te SDK with this customer data (which is persisted; no need to call this every time). The key should use reverse-dns-like notation to be used as a domain. For instance, the user hometown should use a "user.hometown" key. A few keys are provided (Firstname, lastname, gender...)</p>
<pre><code class="java">B4SUserProperty.get().store(B4SUserProperty.USER_FIRST_NAME, &quot;Jean-Michel&quot;);
B4SUserProperty.get().store(B4SUserProperty.USER_LAST_NAME, &quot;BÃ©catresse&quot;);
B4SUserProperty.get().store(B4SUserProperty.USER_GENDER, B4SUserProperty.Gender.Male);
B4SUserProperty.get().store(&quot;user.hometown&quot;, &quot;Tubbydome&quot;);
</code></pre>

<h1 id="application-tagging">Application tagging</h1>
<p>You can tag your application with the B4S SDK. You can set two values : The first parameter is the event descriptor and the second the userData asociated to the event. </p>
<pre><code class="java">B4S.event(&quot;Launch&quot;,&quot;No Data&quot;);
</code></pre>

<p>You can even set your own data dictionary.</p>
<pre><code class="java">Hashtable tags = new Hashtable();
tags.put(&quot;Key1&quot;,&quot;String1&quot;);
tags.put(&quot;Key2&quot;,&quot;String2&quot;);
tags.put(&quot;Key3&quot;,4);
B4STag.event(&quot;Test&quot;, tags);
</code></pre>

<h1 id="custom-notifications">Custom notifications</h1>
<p>Icons, icon background colour and vibration can be customised on notifications.</p>
<pre><code class="java">B4SSettings.get().setNotificationBackgroundColor(0xff111111);
B4SSettings.get().setCustomNotificationSmallIcon(R.drawable.ic_notifsmall);
B4SSettings.get().setCustomNotificationLargeIcon(R.drawable.ic_notiflarge);
B4SSettings.get().setShouldVibrateOnNotification(true);
</code></pre>

<h1 id="push-notifications">Push notifications</h1>
<p><em>To use remote push notifications you must first follow the instructions of the "Base integration"</em></p>
<p>To use remote push messaging with the Neerby SDK, ensure that the <code>play-services-gcm</code> library is properly specified in your <code>app/build.gradle</code> dependencies:</p>
<pre><code class="groovy">{
    compile 'com.google.android.gms:play-services-gcm:8.4.0'
}
</code></pre>

<h2 id="deep-linking">Deep linking</h2>
<p>Notifications such as web links or simple messages are handled directly by the SDK. For deep linking (and deep linking only), there are three options:</p>
<ul>
<li><code>DeepLinkStyle.LaunchActivityClearTask</code> - (Default) Deep links are delivered to your launch Activity, and always in a new task (with an Activity restart)</li>
<li><code>DeepLinkStyle.LaunchActivityDirect</code> - Deep links are delivered to your launch Activity; if this is already running the Intent is delivered directly to your <code>onNewIntent</code> lifecycle method</li>
<li><code>DeepLinkStyle.BroadcastReceiver</code> - Deep links are broadcasted with a <code>com.ezeeworld.b4s.android.sdk.notifications.DEEP_LINK</code> Intent action type</li>
</ul>
<p>The strategy can be set by calling a static method, typically after you have initialized the SDK in your <code>Application</code> class:</p>
<pre><code class="java">   NotificationService.registerDeepLinkStyle(NotificationService.DeepLinkStyle deepLinkStyle);
</code></pre>

<p>When you configure to use <code>DeepLinkStyle.BroadcastReceiver</code> deep links, the application can and must register a <code>BroadcastReceiver</code> that handles the deep links, such as opening a specific Activity or starting a Service. In your <code>AndroidManifest.xml</code> you declare:</p>
<pre><code class="xml">   &lt;receiver android:name=&quot;.DeepLinkReceiver&quot;&gt;
      &lt;intent-filter&gt;
         &lt;action android:name=&quot;com.ezeeworld.b4s.android.sdk.notifications.DEEP_LINK&quot; /&gt;
      &lt;/intent-filter&gt;
   &lt;/receiver&gt;
</code></pre>

<p>The <code>DeepLinkReceiver</code> can, in its simplest form, simply relay the broadcasts to some other Activity:</p>
<pre><code class="java">    public class DeepLinkReceiver extends BroadcastReceiver {
       @Override
       public void onReceive(Context context, Intent intent) {
          intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); // Required as no Activity context is available
          context.startActivity(intent);
       }
    }
</code></pre>

<p>Deep link <code>Intent</code>s contain a bundle of extras to respond appropriately:</p>
<ul>
<li><code>NotificationService.INTENT_SHOW</code> - (int) Hash code of the interaction that was matched</li>
<li><code>NotificationService.INTENT_INTERACTION</code> - (String) Name interaction that was matched</li>
<li><code>NotificationService.INTENT_CAMPAIGNNAME</code> - (String) Name of the campaign the matched interaction belongs to</li>
<li><code>NotificationService.INTENT_INTERACTIONNAME</code> - (String) Unique ID of the interaction that was matched</li>
<li><code>NotificationService.INTENT_TITLE</code> - (String) Message title, defaults to interaction name if no custom title was supplied</li>
<li><code>NotificationService.INTENT_MESSAGE</code> - (String) Message, in which customer name, beacon name, shop name, etc. were already substituted</li>
<li><code>NotificationService.INTENT_SHOPNAME</code> - (String) Name of the interaction's shop</li>
<li><code>NotificationService.INTENT_SHOPCLIENTREF</code> - (String) The free-form string set on the shop as client reference</li>
<li><code>NotificationService.INTENT_GROUPNAME</code> - (String) Name of the interaction's group</li>
<li><code>NotificationService.INTENT_ACTIONID</code> - (String) The free-form string with the campaign action id set as deep link reference</li>
<li><code>NotificationService.INTENT_BEACONNAME</code> - (String) Name of the matched beacon as configured in the SDK</li>
<li><code>NotificationService.INTENT_BEACONID</code> - (IBeaconID) Beacon identification, including technical name (B4S:XXXX:XXXX), UDID, major and minor</li>
<li><code>NotificationService.INTENT_BEACONCLIENTREF</code> - (String) The free-form string set on the beacon as client reference</li>
<li><code>NotificationService.INTENT_DISTANCE</code> - (double) Distance estimate in meters</li>
<li><code>NotificationService.INTENT_SHOPLATITUDE</code> - (double) Latitude of the shop associated to the notification</li>
<li><code>NotificationService.INTENT_SHOPLONGITUDE</code> - (double) Longitude of the shop associated to the notification</li>
</ul>
<h2 id="dynamic-notifications-customisation">Dynamic notifications customisation</h2>
<p>You have the possibility to let your code modify every notification before they are display to the use.</p>
<p>In order to achieve this, you had to :</p>
<ul>
<li>Add the NotificationService.NotificationModifier interface to the class which will be responsible of the notifications customisation.</li>
<li>Register the previous class with </li>
</ul>
<pre><code class="java">    NotificationService.registerNotificationModifier(this);
</code></pre>

<ul>
<li>Implements the two methods :</li>
</ul>
<pre><code class="java">public String modifyNotificationTitle(Bundle extras) {

}

public String modifyNotificationMessage(Bundle extras) {

}
</code></pre>

<p>The string returned by these methods will be respectively the modified title and message of the notification. You can even modify the notification properties of the notifications.</p>
<h2 id="android-6">Android 6</h2>
<p>With Android 6.0 (API level 23) a new permission system was introduced by Google. On Android 6 devices, users can manually manage permissions on a per-application basis. If an app targets Android 6 (using targetSdkVersion 23 and compileSdkVersion 23), an app also needs to deal with runtime permissions. This means that permissions such as location access (which is now a so-called 'dangerous' permission) needs to be explicitly requested with a permission request pop-up. Until SDK version 1.4.2, the B4S SDK does not handle this automatically and therefor the integrator needs to <a href="https://developer.android.com/training/permissions/requesting.html">handle permission request dialogs manually</a>.</p>
<p>From version 1.5.0 onwards this will be handled for you by the SDK. A request to access the user location will automatically be shown when access was not yet granted. It is important to note that this affects any application when running on an Android 6 device, even those that still target API level 22 or lower.</p>
<h1 id="using-a-transient-device-uuid">Using a transient device UUID</h1>
<p><strong>Warning</strong>: using this feature is <em>not</em> recommended</p>
<p>Upon the app installation, an anymous and persistent device UUID is used if the app is un-installed then re-installed. To make this ID transient add a <code>by.neer.sdk.USE_TRANSIENT_DEVICEID</code> key to your AndroidManifest.xml, with the value <code>true</code> in the application block.</p>
<pre><code class="xml">&lt;meta-data android:name=&quot;by.neer.sdk.USE_TRANSIENT_DEVICEID&quot; android:value=&quot;true&quot; /&gt;
</code></pre>

<h1 id="getting-the-users-worlplace-and-home-coordinates">Getting the user's worlplace and home coordinates</h1>
<p>The SDK tries to determinate the user's home &amp; workplace coordinate. When accessing those, home and workplace coordinates should be null if the SDK still do not collect enough information to identify the customer home and workplace locations.</p>
<pre><code class="java">
Location home = B4SSettings.get().userHomeCoordinates();
if (home != null)
{
    // Use the coordinates
}
Location work = B4SSettings.get().userWorkplaceCoordinates();
if (work != null)
{
    // Use the coordinates
}

</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../migration_guide/" class="btn btn-neutral float-right" title="Migration guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../include_in_project/" class="btn btn-neutral" title="Include the SDK in your project"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../include_in_project/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../migration_guide/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>
      <script src="../js/syntax_language_name.js"></script>

</body>
</html>
